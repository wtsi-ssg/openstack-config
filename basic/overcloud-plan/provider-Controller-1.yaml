description: 'OpenStack controller node configured by Puppet.

  '
heat_template_version: 2015-04-30
outputs:
  config_identifier:
    description: identifier which changes if the controller configuration may need
      re-applying
    value:
      list_join:
      - ','
      - - get_attr:
          - ControllerDeployment
          - deploy_stdout
        - get_attr:
          - ControllerExtraConfigPre
          - deploy_stdout
  corosync_node:
    description: 'Node object in the format {ip: ..., name: ...} format that the corosync
      element expects

      '
    value:
      ip:
        get_attr:
        - Controller
        - networks
        - ctlplane
        - 0
      name:
        get_attr:
        - Controller
        - name
  external_ip_address:
    description: IP address of the server in the external network
    value:
      get_attr:
      - ExternalPort
      - ip_address
  hostname:
    description: Hostname of the server
    value:
      get_attr:
      - Controller
      - name
  hosts_entry:
    description: 'Server''s IP address and hostname in the /etc/hosts format

      '
    value:
      str_replace:
        params:
          CLOUDNAME:
            get_param: CloudName
          HOST:
            get_attr:
            - Controller
            - name
          IP:
            get_attr:
            - NetIpMap
            - net_ip_map
            - get_param:
              - ServiceNetMap
              - ControllerHostnameResolveNetwork
        template: IP HOST.localdomain HOST CLOUDNAME
  internal_api_ip_address:
    description: IP address of the server in the internal_api network
    value:
      get_attr:
      - InternalApiPort
      - ip_address
  ip_address:
    description: IP address of the server in the ctlplane network
    value:
      get_attr:
      - Controller
      - networks
      - ctlplane
      - 0
  nova_server_resource:
    description: Heat resource handle for the Nova compute server
    value:
      get_resource: Controller
  storage_ip_address:
    description: IP address of the server in the storage network
    value:
      get_attr:
      - StoragePort
      - ip_address
  storage_mgmt_ip_address:
    description: IP address of the server in the storage_mgmt network
    value:
      get_attr:
      - StorageMgmtPort
      - ip_address
  swift_device:
    description: Swift device formatted for swift-ring-builder
    value:
      str_replace:
        params:
          IP:
            get_attr:
            - NetIpMap
            - net_ip_map
            - get_param:
              - ServiceNetMap
              - SwiftMgmtNetwork
        template: r1z1-IP:%PORT%/d1
  swift_proxy_memcache:
    description: Swift proxy-memcache value
    value:
      str_replace:
        params:
          IP:
            get_attr:
            - NetIpMap
            - net_ip_map
            - get_param:
              - ServiceNetMap
              - MemcachedNetwork
        template: IP:11211
  tenant_ip_address:
    description: IP address of the server in the tenant network
    value:
      get_attr:
      - TenantPort
      - ip_address
parameters:
  AdminPassword:
    default: unset
    description: The password for the keystone admin account, used for monitoring,
      querying neutron etc.
    hidden: true
    type: string
  AdminToken:
    default: unset
    description: The keystone auth secret and db password.
    hidden: true
    type: string
  CeilometerBackend:
    default: mongodb
    description: The ceilometer backend type.
    type: string
  CeilometerMeteringSecret:
    default: unset
    description: Secret shared by the ceilometer services.
    hidden: true
    type: string
  CeilometerPassword:
    default: unset
    description: The password for the ceilometer service  and db account.
    hidden: true
    type: string
  CinderBackendConfig:
    default: {}
    description: Contains parameters to configure Cinder backends. Typically set via
      parameter_defaults in the resource registry.
    type: json
  CinderEnableIscsiBackend:
    default: true
    description: Whether to enable or not the Iscsi backend for Cinder
    type: boolean
  CinderEnableNfsBackend:
    default: false
    description: Whether to enable or not the NFS backend for Cinder
    type: boolean
  CinderEnableRbdBackend:
    default: false
    description: Whether to enable or not the Rbd backend for Cinder
    type: boolean
  CinderISCSIHelper:
    default: tgtadm
    description: The iSCSI helper to use with cinder.
    type: string
  CinderLVMLoopDeviceSize:
    default: 5000
    description: The size of the loopback file used by the cinder LVM driver.
    type: number
  CinderNfsMountOptions:
    default: ''
    description: 'Mount options for NFS mounts used by Cinder NFS backend. Effective
      when CinderEnableNfsBackend is true.

      '
    type: string
  CinderNfsServers:
    default: ''
    description: 'NFS servers used by Cinder NFS backend. Effective when CinderEnableNfsBackend
      is true.

      '
    type: comma_delimited_list
  CinderPassword:
    default: unset
    description: The password for the cinder service and db account, used by cinder-api.
    hidden: true
    type: string
  CloudName:
    default: ''
    description: The DNS name of this cloud. E.g. ci-overcloud.tripleo.org
    type: string
  ControlVirtualInterface:
    default: br-ex
    description: Interface where virtual ip will be assigned.
    type: string
  ControllerExtraConfig:
    default: {}
    description: 'Controller specific configuration to inject into the cluster. Same

      structure as ExtraConfig.

      '
    type: json
  Debug:
    default: ''
    description: Set to True to enable debugging on all services.
    type: string
  EnableCephStorage:
    default: false
    description: Whether to deploy Ceph Storage (OSD) on the Controller
    type: boolean
  EnableGalera:
    default: true
    description: Whether to use Galera instead of regular MariaDB.
    type: boolean
  EnablePacemaker:
    default: false
    description: If enabled services will be monitored by Pacemaker; it will manage
      VIPs as well, in place of Keepalived.
    type: boolean
  EnablePackageInstall:
    default: 'false'
    description: Set to true to enable package installation via Puppet
    type: boolean
  EnableSwiftStorage:
    default: true
    description: Whether to enable Swift Storage on the Controller
    type: boolean
  ExtraConfig:
    default: {}
    description: "Additional configuration to inject into the cluster. The JSON should\
      \ have\nthe following structure:\n  {\"FILEKEY\":\n    {\"config\":\n      [{\"\
      section\": \"SECTIONNAME\",\n        \"values\":\n          [{\"option\": \"\
      OPTIONNAME\",\n            \"value\": \"VALUENAME\"\n           }\n        \
      \  ]\n       }\n      ]\n    }\n  }\nFor instance:\n  {\"nova\":\n    {\"config\"\
      :\n      [{\"section\": \"default\",\n        \"values\":\n          [{\"option\"\
      : \"compute_manager\",\n            \"value\": \"ironic.nova.compute.manager.ClusterComputeManager\"\
      \n           }\n          ]\n       },\n       {\"section\": \"cells\",\n  \
      \      \"values\":\n          [{\"option\": \"driver\",\n            \"value\"\
      : \"nova.cells.rpc_driver.CellsRPCDriver\"\n           }\n          ]\n    \
      \   }\n      ]\n    }\n  }\n"
    type: json
  Flavor:
    constraints:
    - custom_constraint: nova.flavor
    description: Flavor for control nodes to request when deploying.
    type: string
  GlanceApiVirtualIP:
    default: ''
    type: string
  GlanceBackend:
    constraints:
    - allowed_values:
      - swift
      - file
      - rbd
    default: swift
    description: The short name of the Glance backend to use. Should be one of swift,
      rbd, or file
    type: string
  GlanceFilePcmkDevice:
    default: ''
    description: 'An exported storage device that should be mounted by Pacemaker as
      Glance storage. Effective when GlanceFilePcmkManage is true.

      '
    type: string
  GlanceFilePcmkFstype:
    default: nfs
    description: 'Filesystem type for Pacemaker mount used as Glance storage. Effective
      when GlanceFilePcmkManage is true.

      '
    type: string
  GlanceFilePcmkManage:
    default: false
    description: 'Whether to make Glance file backend a mount managed by Pacemaker.
      Effective when GlanceBackend is ''file''.

      '
    type: boolean
  GlanceFilePcmkOptions:
    default: ''
    description: 'Mount options for Pacemaker mount used as Glance storage. Effective
      when GlanceFilePcmkManage is true.

      '
    type: string
  GlanceLogFile:
    default: ''
    description: The filepath of the file to use for logging messages from Glance.
    type: string
  GlanceNotifierStrategy:
    default: noop
    description: Strategy to use for Glance notification queue
    type: string
  GlancePassword:
    default: unset
    description: The password for the glance service and db account, used by the glance
      services.
    hidden: true
    type: string
  GlancePort:
    default: '9292'
    description: Glance port.
    type: string
  GlanceProtocol:
    default: http
    description: Protocol to use when connecting to glance, set to https for SSL.
    type: string
  HeatApiVirtualIP:
    default: ''
    type: string
  HeatAuthEncryptionKey:
    description: Auth encryption key for heat-engine
    type: string
  HeatPassword:
    default: unset
    description: The password for the Heat service and db account, used by the Heat
      services.
    hidden: true
    type: string
  HeatStackDomainAdminPassword:
    default: unset
    description: Password for heat_stack_domain_admin user.
    hidden: true
    type: string
  HorizonSecret:
    description: Secret key for Django
    type: string
  Hostname:
    default: ''
    type: string
  Image:
    constraints:
    - custom_constraint: glance.image
    default: overcloud-control
    type: string
  ImageUpdatePolicy:
    default: REBUILD_PRESERVE_EPHEMERAL
    description: What policy to use when reconstructing instances. REBUILD for rebuilds,
      REBUILD_PRESERVE_EPHEMERAL to preserve /mnt.
    type: string
  KeyName:
    constraints:
    - custom_constraint: nova.keypair
    default: default
    description: Name of an existing EC2 KeyPair to enable SSH access to the instances
    type: string
  KeystoneCACertificate:
    default: ''
    description: Keystone self-signed certificate authority certificate.
    type: string
  KeystonePublicApiVirtualIP:
    default: ''
    type: string
  KeystoneSSLCertificate:
    default: ''
    description: Keystone certificate for verifying token validity.
    type: string
  KeystoneSSLCertificateKey:
    default: ''
    description: Keystone key for signing tokens.
    hidden: true
    type: string
  KeystoneSigningCertificate:
    default: ''
    description: Keystone certificate for verifying token validity.
    type: string
  KeystoneSigningKey:
    default: ''
    description: Keystone key for signing tokens.
    hidden: true
    type: string
  MysqlClusterUniquePart:
    default: unset
    description: A unique identifier of the MySQL cluster the controller is in.
    type: string
  MysqlInnodbBufferPoolSize:
    default: 0
    description: 'Specifies the size of the buffer pool in megabytes. Setting to zero
      should be interpreted as "no value" and will defer to the lower level default.

      '
    type: number
  MysqlMaxConnections:
    default: 1024
    description: Configures MySQL max_connections config setting
    type: number
  MysqlRootPassword:
    default: ''
    hidden: true
    type: string
  MysqlVirtualIP:
    default: ''
    type: string
  NeutronAgentMode:
    default: dvr_snat
    description: Agent mode for the neutron-l3-agent on the controller hosts
    type: string
  NeutronAllowL3AgentFailover:
    default: 'True'
    description: Allow automatic l3-agent failover
    type: string
  NeutronApiVirtualIP:
    default: ''
    type: string
  NeutronBridgeMappings:
    default: datacentre:br-ex
    description: 'The OVS logical->physical bridge mappings to use. See the Neutron
      documentation for details. Defaults to mapping br-ex - the external bridge on
      hosts - to a physical name ''datacentre'' which can be used to create provider
      networks (and we use this for the default floating network) - if changing this
      either use different post-install network scripts or be sure to keep ''datacentre''
      as a mapping network name.

      '
    type: string
  NeutronDVR:
    default: 'False'
    description: Whether to configure Neutron Distributed Virtual Routers
    type: string
  NeutronDhcpAgentsPerNetwork:
    default: 3
    description: The number of neutron dhcp agents to schedule per network
    type: number
  NeutronDnsmasqOptions:
    default: dhcp-option-force=26,1400
    description: Dnsmasq options for neutron-dhcp-agent. The default value here forces
      MTU to be set to 1400 to account for the gre tunnel overhead.
    type: string
  NeutronEnableTunnelling:
    default: 'True'
    type: string
  NeutronExternalNetworkBridge:
    default: br-ex
    description: Name of bridge used for external network traffic.
    type: string
  NeutronFlatNetworks:
    default: datacentre
    description: If set, flat networks to configure in neutron plugins.
    type: string
  NeutronL3HA:
    default: 'False'
    description: Whether to enable l3-agent HA
    type: string
  NeutronMechanismDrivers:
    default: openvswitch
    description: 'The mechanism drivers for the Neutron tenant network. To specify
      multiple

      values, use a comma separated string, like so: ''openvswitch,l2_population''

      '
    type: string
  NeutronMetadataProxySharedSecret:
    default: unset
    description: Shared secret to prevent spoofing
    type: string
  NeutronNetworkType:
    default: gre
    description: The tenant network type for Neutron, either gre or vxlan.
    type: string
  NeutronNetworkVLANRanges:
    default: datacentre
    description: 'The Neutron ML2 and OpenVSwitch vlan mapping range to support. See
      the Neutron documentation for permitted values. Defaults to permitting any VLAN
      on the ''datacentre'' physical network (See NeutronBridgeMappings).

      '
    type: comma_delimited_list
  NeutronPassword:
    default: unset
    description: The password for the neutron service and db account, used by neutron
      agents.
    hidden: true
    type: string
  NeutronPublicInterface:
    default: nic1
    description: What interface to bridge onto br-ex for network nodes.
    type: string
  NeutronPublicInterfaceDefaultRoute:
    default: ''
    description: A custom default route for the NeutronPublicInterface.
    type: string
  NeutronPublicInterfaceIP:
    default: ''
    description: A custom IP address to put onto the NeutronPublicInterface.
    type: string
  NeutronPublicInterfaceRawDevice:
    default: ''
    description: If set, the public interface is a vlan with this device as the raw
      device.
    type: string
  NeutronPublicInterfaceTag:
    default: ''
    description: 'VLAN tag for creating a public VLAN. The tag will be used to create
      an access port on the exterior bridge for each control plane node, and that
      port will be given the IP address returned by neutron from the public network.
      Set CONTROLEXTRA=overcloud-vlan-port.yaml when compiling overcloud.yaml to include
      the deployment of VLAN ports to the control plane.

      '
    type: string
  NeutronTunnelIdRanges:
    default: 1:1000
    description: 'Comma-separated list of <tun_min>:<tun_max> tuples enumerating ranges

      of GRE tunnel IDs that are available for tenant network allocation

      '
    type: comma_delimited_list
  NeutronTunnelTypes:
    default: gre
    description: 'The tunnel types for the Neutron tenant network. To specify multiple

      values, use a comma separated string, like so: ''gre,vxlan''

      '
    type: string
  NeutronVniRanges:
    default: 1:1000
    description: 'Comma-separated list of <vni_min>:<vni_max> tuples enumerating ranges

      of VXLAN VNI IDs that are available for tenant network allocation

      '
    type: comma_delimited_list
  NovaPassword:
    default: unset
    description: The password for the nova service and db account, used by nova-api.
    hidden: true
    type: string
  NtpServer:
    default: ''
    type: string
  PcsdPassword:
    description: The password for the 'pcsd' user.
    type: string
  PublicVirtualIP:
    default: ''
    type: string
  PublicVirtualInterface:
    default: br-ex
    description: 'Specifies the interface where the public-facing virtual ip will
      be assigned. This should be int_public when a VLAN is being used.

      '
    type: string
  RabbitClientPort:
    default: 5672
    description: Set rabbit subscriber port, change this if using SSL
    type: number
  RabbitClientUseSSL:
    default: false
    description: 'Rabbit client subscriber parameter to specify an SSL connection
      to the RabbitMQ host.

      '
    type: string
  RabbitCookie:
    default: ''
    hidden: true
    type: string
  RabbitPassword:
    default: guest
    description: The password for RabbitMQ
    hidden: true
    type: string
  RabbitUserName:
    default: guest
    description: The username for RabbitMQ
    type: string
  RedisVirtualIP:
    default: ''
    type: string
  SSLCACertificate:
    default: ''
    description: If set, the contents of an SSL certificate authority file.
    type: string
  SSLCertificate:
    default: ''
    description: If set, the contents of an SSL certificate .crt file for encrypting
      SSL endpoints.
    hidden: true
    type: string
  SSLKey:
    default: ''
    description: If set, the contents of an SSL certificate .key file for encrypting
      SSL endpoints.
    hidden: true
    type: string
  ServiceNetMap:
    default: {}
    description: Mapping of service_name -> network name. Typically set via parameter_defaults
      in the resource registry.
    type: json
  SnmpdReadonlyUserName:
    default: ro_snmp_user
    description: The user name for SNMPd with readonly rights running on all Overcloud
      nodes
    type: string
  SnmpdReadonlyUserPassword:
    default: unset
    description: The user password for SNMPd with readonly rights running on all Overcloud
      nodes
    hidden: true
    type: string
  SwiftHashSuffix:
    default: unset
    description: A random string to be used as a salt when hashing to determine mappings
      in the ring.
    hidden: true
    type: string
  SwiftMinPartHours:
    default: 1
    description: The minimum time (in hours) before a partition in a ring can be moved
      following a rebalance.
    type: number
  SwiftMountCheck:
    default: 'false'
    description: Value of mount_check in Swift account/container/object -server.conf
    type: boolean
  SwiftPartPower:
    default: 10
    description: Partition Power to use when building Swift rings
    type: number
  SwiftPassword:
    default: unset
    description: The password for the swift service account, used by the swift proxy
      services.
    hidden: true
    type: string
  SwiftReplicas:
    default: 3
    description: How many replicas to use in the swift rings.
    type: number
  UpdateIdentifier:
    default: ''
    description: 'Setting to a previously unused value during stack-update will trigger
      package update on all nodes

      '
    type: string
  VirtualIP:
    default: ''
    type: string
resources:
  Controller:
    properties:
      flavor:
        get_param: Flavor
      image:
        get_param: Image
      image_update_policy:
        get_param: ImageUpdatePolicy
      key_name:
        get_param: KeyName
      name:
        get_param: Hostname
      networks:
      - network: ctlplane
      user_data:
        get_resource: NodeUserData
      user_data_format: SOFTWARE_CONFIG
    type: OS::Nova::Server
  ControllerConfig:
    properties:
      config:
        hiera:
          datafiles:
            ceph:
              mapped_data:
                ceph::mon::public_addr:
                  get_input: ceph_public_ip
                ceph::profile::params::cluster_network:
                  get_input: ceph_cluster_network
                ceph::profile::params::public_network:
                  get_input: ceph_public_network
              raw_data:
                get_file: hieradata/ceph.yaml
            common:
              raw_data:
                get_file: hieradata/common.yaml
            controller:
              mapped_data:
                admin_password:
                  get_input: admin_password
                apache::ip:
                  get_input: horizon_network
                bootstack_nodeid:
                  get_input: bootstack_nodeid
                ceilometer::agent::auth::auth_password:
                  get_input: ceilometer_password
                ceilometer::agent::auth::auth_url:
                  get_input: keystone_auth_address
                ceilometer::agent::central::coordination_url:
                  get_input: ceilometer_coordination_url
                ceilometer::api::host:
                  get_input: ceilometer_api_network
                ceilometer::api::keystone_auth_uri:
                  get_input: keystone_auth_uri
                ceilometer::api::keystone_identity_uri:
                  get_input: keystone_identity_uri
                ceilometer::api::keystone_password:
                  get_input: ceilometer_password
                ceilometer::debug:
                  get_input: debug
                ceilometer::metering_secret:
                  get_input: ceilometer_metering_secret
                ceilometer::rabbit_password:
                  get_input: rabbit_password
                ceilometer::rabbit_port:
                  get_input: rabbit_client_port
                ceilometer::rabbit_use_ssl:
                  get_input: rabbit_client_use_ssl
                ceilometer::rabbit_userid:
                  get_input: rabbit_username
                ceilometer_backend:
                  get_input: ceilometer_backend
                ceilometer_mysql_conn_string:
                  get_input: ceilometer_dsn
                cinder::api::auth_uri:
                  get_input: keystone_auth_uri
                cinder::api::bind_host:
                  get_input: cinder_api_network
                cinder::api::identity_uri:
                  get_input: keystone_identity_uri
                cinder::api::keystone_password:
                  get_input: cinder_password
                cinder::database_connection:
                  get_input: cinder_dsn
                cinder::debug:
                  get_input: debug
                cinder::glance::glance_api_servers:
                  get_input: glance_api_servers
                cinder::rabbit_password:
                  get_input: rabbit_password
                cinder::rabbit_port:
                  get_input: rabbit_client_port
                cinder::rabbit_use_ssl:
                  get_input: rabbit_client_use_ssl
                cinder::rabbit_userid:
                  get_input: rabbit_username
                cinder_backend_config:
                  get_input: CinderBackendConfig
                cinder_enable_iscsi_backend:
                  get_input: cinder_enable_iscsi_backend
                cinder_enable_nfs_backend:
                  get_input: cinder_enable_nfs_backend
                cinder_enable_rbd_backend:
                  get_input: cinder_enable_rbd_backend
                cinder_iscsi_helper:
                  get_input: cinder_iscsi_helper
                cinder_iscsi_ip_address:
                  get_input: cinder_iscsi_network
                cinder_lvm_loop_device_size:
                  get_input: cinder_lvm_loop_device_size
                cinder_nfs_mount_options:
                  get_input: cinder_nfs_mount_options
                cinder_nfs_servers:
                  get_input: cinder_nfs_servers
                control_virtual_interface:
                  get_input: control_virtual_interface
                enable_ceph_storage:
                  get_input: enable_ceph_storage
                enable_galera:
                  get_input: enable_galera
                enable_package_install:
                  get_input: enable_package_install
                enable_swift_storage:
                  get_input: enable_swift_storage
                glance::api::auth_uri:
                  get_input: keystone_auth_uri
                glance::api::bind_host:
                  get_input: glance_api_network
                glance::api::bind_port:
                  get_input: glance_port
                glance::api::database_connection:
                  get_input: glance_dsn
                glance::api::debug:
                  get_input: debug
                glance::api::identity_uri:
                  get_input: keystone_identity_uri
                glance::api::keystone_password:
                  get_input: glance_password
                glance::api::registry_host:
                  get_input: glance_registry_network
                glance::backend::swift::swift_store_auth_address:
                  get_input: keystone_auth_address
                glance::backend::swift::swift_store_key:
                  get_input: glance_password
                glance::backend::swift::swift_store_user: service:glance
                glance::registry::auth_uri:
                  get_input: keystone_auth_uri
                glance::registry::bind_host:
                  get_attr:
                  - NetIpMap
                  - net_ip_map
                  - get_param:
                    - ServiceNetMap
                    - GlanceRegistryNetwork
                glance::registry::database_connection:
                  get_input: glance_dsn
                glance::registry::debug:
                  get_input: debug
                glance::registry::identity_uri:
                  get_input: keystone_identity_uri
                glance::registry::keystone_password:
                  get_input: glance_password
                glance_backend:
                  get_input: glance_backend
                glance_file_pcmk_device:
                  get_param: GlanceFilePcmkDevice
                glance_file_pcmk_fstype:
                  get_param: GlanceFilePcmkFstype
                glance_file_pcmk_manage:
                  get_param: GlanceFilePcmkManage
                glance_file_pcmk_options:
                  get_param: GlanceFilePcmkOptions
                glance_log_file:
                  get_input: glance_log_file
                glance_notifier_strategy:
                  get_input: glance_notifier_strategy
                hacluster_pwd:
                  get_input: pcsd_password
                heat::api::bind_host:
                  get_input: heat_api_network
                heat::api_cfn::bind_host:
                  get_input: heat_api_network
                heat::api_cloudwatch::bind_host:
                  get_input: heat_api_network
                heat::auth_uri:
                  get_input: keystone_auth_uri
                heat::database_connection:
                  get_input: heat_dsn
                heat::debug:
                  get_input: debug
                heat::engine::auth_encryption_key:
                  get_input: heat_auth_encryption_key
                heat::engine::heat_metadata_server_url:
                  get_input: heat.metadata_server_url
                heat::engine::heat_waitcondition_server_url:
                  get_input: heat.waitcondition_server_url
                heat::engine::heat_watch_server_url:
                  get_input: heat.watch_server_url
                heat::identity_uri:
                  get_input: keystone_identity_uri
                heat::keystone::domain::auth_url:
                  list_join:
                  - ''
                  - - http://
                    - get_param: KeystonePublicApiVirtualIP
                    - :35357/v2.0
                heat::keystone::domain::domain_password:
                  get_input: heat_stack_domain_admin_password
                heat::keystone::domain::keystone_password:
                  get_input: admin_password
                heat::keystone_ec2_uri:
                  get_input: keystone_ec2_uri
                heat::keystone_password:
                  get_input: heat_password
                heat::rabbit_password:
                  get_input: rabbit_password
                heat::rabbit_port:
                  get_input: rabbit_client_port
                heat::rabbit_use_ssl:
                  get_input: rabbit_client_use_ssl
                heat::rabbit_userid:
                  get_input: rabbit_username
                heat_stack_domain_admin_password:
                  get_input: heat_stack_domain_admin_password
                horizon::bind_address:
                  get_input: horizon_network
                horizon::django_debug:
                  get_input: debug
                horizon::keystone_url:
                  get_input: keystone_auth_uri
                horizon::secret_key:
                  get_input: horizon_secret
                keystone::admin_bind_host:
                  get_input: keystone_admin_api_network
                keystone::admin_token:
                  get_input: admin_token
                keystone::database_connection:
                  get_input: keystone_dsn
                keystone::debug:
                  get_input: debug
                keystone::public_bind_host:
                  get_input: keystone_public_api_network
                keystone::roles::admin::password:
                  get_input: admin_password
                keystone_ca_certificate:
                  get_input: keystone_ca_certificate
                keystone_signing_certificate:
                  get_input: keystone_signing_certificate
                keystone_signing_key:
                  get_input: keystone_signing_key
                keystone_ssl_certificate:
                  get_input: keystone_ssl_certificate
                keystone_ssl_certificate_key:
                  get_input: keystone_ssl_certificate_key
                memcached::listen_ip:
                  get_input: memcached_network
                mongodb::server::bind_ip:
                  get_input: mongo_db_network
                mysql::server::root_password:
                  get_input: mysql_root_password
                mysql_bind_host:
                  get_input: mysql_network
                mysql_cluster_name:
                  get_input: mysql_cluster_name
                mysql_innodb_buffer_pool_size:
                  get_input: mysql_innodb_buffer_pool_size
                mysql_max_connections:
                  get_input: mysql_max_connections
                neutron::agents::l3::external_network_bridge:
                  get_input: neutron_external_network_bridge
                neutron::agents::metadata::auth_password:
                  get_input: neutron_password
                neutron::agents::metadata::auth_url:
                  get_input: keystone_identity_uri
                neutron::agents::metadata::metadata_ip:
                  get_input: neutron_api_network
                neutron::agents::metadata::shared_secret:
                  get_input: neutron_metadata_proxy_shared_secret
                neutron::agents::ml2::ovs::enable_tunneling:
                  get_input: neutron_enable_tunneling
                neutron::agents::ml2::ovs::local_ip:
                  get_input: neutron_local_ip
                neutron::bind_host:
                  get_input: neutron_api_network
                neutron::debug:
                  get_input: debug
                neutron::dhcp_agents_per_network:
                  get_input: neutron_dhcp_agents_per_network
                neutron::plugins::ml2::network_vlan_ranges:
                  get_input: neutron_network_vlan_ranges
                neutron::plugins::ml2::tunnel_id_ranges:
                  get_input: neutron_tunnel_id_ranges
                neutron::plugins::ml2::vni_ranges:
                  get_input: neutron_vni_ranges
                neutron::rabbit_password:
                  get_input: rabbit_password
                neutron::rabbit_port:
                  get_input: rabbit_client_port
                neutron::rabbit_use_ssl:
                  get_input: rabbit_client_use_ssl
                neutron::rabbit_user:
                  get_input: rabbit_user
                neutron::server::allow_automatic_l3agent_failover:
                  get_input: neutron_allow_l3agent_failover
                neutron::server::auth_password:
                  get_input: neutron_password
                neutron::server::auth_uri:
                  get_input: keystone_auth_uri
                neutron::server::database_connection:
                  get_input: neutron_dsn
                neutron::server::identity_uri:
                  get_input: keystone_identity_uri
                neutron::server::l3_ha:
                  get_input: neutron_l3_ha
                neutron_agent_mode:
                  get_input: neutron_agent_mode
                neutron_bridge_mappings:
                  get_input: neutron_bridge_mappings
                neutron_dnsmasq_options:
                  get_input: neutron_dnsmasq_options
                neutron_dsn:
                  get_input: neutron_dsn
                neutron_flat_networks:
                  get_input: neutron_flat_networks
                neutron_mechanism_drivers:
                  get_input: neutron_mechanism_drivers
                neutron_public_interface:
                  get_input: neutron_public_interface
                neutron_public_interface_default_route:
                  get_input: neutron_public_interface_default_route
                neutron_public_interface_ip:
                  get_input: neutron_public_interface_ip
                neutron_public_interface_raw_device:
                  get_input: neutron_public_interface_raw_device
                neutron_public_interface_tag:
                  get_input: neutron_public_interface_tag
                neutron_router_distributed:
                  get_input: neutron_router_distributed
                neutron_tenant_network_type:
                  get_input: neutron_tenant_network_type
                neutron_tunnel_types:
                  get_input: neutron_tunnel_types
                nova::api::admin_password:
                  get_input: nova_password
                nova::api::api_bind_address:
                  get_input: nova_api_network
                nova::api::auth_uri:
                  get_input: keystone_auth_uri
                nova::api::identity_uri:
                  get_input: keystone_identity_uri
                nova::api::metadata_listen:
                  get_input: nova_metadata_network
                nova::api::neutron_metadata_proxy_shared_secret:
                  get_input: neutron_metadata_proxy_shared_secret
                nova::database_connection:
                  get_input: nova_dsn
                nova::debug:
                  get_input: debug
                nova::glance_api_servers:
                  get_input: glance_api_servers
                nova::network::neutron::neutron_admin_auth_url:
                  get_input: neutron_admin_auth_url
                nova::network::neutron::neutron_admin_password:
                  get_input: neutron_password
                nova::network::neutron::neutron_url:
                  get_input: neutron_url
                nova::rabbit_password:
                  get_input: rabbit_password
                nova::rabbit_port:
                  get_input: rabbit_client_port
                nova::rabbit_use_ssl:
                  get_input: rabbit_client_use_ssl
                nova::rabbit_userid:
                  get_input: rabbit_username
                nova::vncproxy::host:
                  get_input: nova_api_network
                ntp::servers:
                  get_input: ntp_servers
                public_virtual_interface:
                  get_input: public_virtual_interface
                rabbitmq::erlang_cookie:
                  get_input: rabbit_cookie
                rabbitmq::node_ip_address:
                  get_input: rabbitmq_network
                redis::bind:
                  get_input: redis_network
                redis_vip:
                  get_input: redis_vip
                snmpd_readonly_user_name:
                  get_input: snmpd_readonly_user_name
                snmpd_readonly_user_password:
                  get_input: snmpd_readonly_user_password
                swift::proxy::authtoken::admin_password:
                  get_input: swift_password
                swift::proxy::authtoken::auth_uri:
                  get_input: keystone_auth_uri
                swift::proxy::authtoken::identity_uri:
                  get_input: keystone_identity_uri
                swift::proxy::proxy_local_net_ip:
                  get_input: swift_proxy_network
                swift::storage::all::storage_local_net_ip:
                  get_input: swift_management_network
                swift::swift_hash_suffix:
                  get_input: swift_hash_suffix
                swift_mount_check:
                  get_input: swift_mount_check
                tripleo::loadbalancer::control_virtual_interface:
                  get_input: control_virtual_interface
                tripleo::loadbalancer::public_virtual_interface:
                  get_input: public_virtual_interface
                tripleo::ringbuilder::build_ring: true
                tripleo::ringbuilder::min_part_hours:
                  get_input: swift_min_part_hours
                tripleo::ringbuilder::part_power:
                  get_input: swift_part_power
                tripleo::ringbuilder::replicas:
                  get_input: swift_replicas
              raw_data:
                get_file: hieradata/controller.yaml
            object:
              raw_data:
                get_file: hieradata/object.yaml
          hierarchy:
          - heat_config_%{::deploy_config_name}
          - controller
          - object
          - swift_devices_and_proxy
          - ceph_cluster
          - ceph
          - bootstrap_node
          - all_nodes
          - vip_data
          - RedHat
          - common
          - cinder_netapp_data
      group: os-apply-config
    type: OS::Heat::StructuredConfig
  ControllerDeployment:
    depends_on: NetworkDeployment
    properties:
      config:
        get_resource: ControllerConfig
      input_values:
        admin_password:
          get_param: AdminPassword
        admin_token:
          get_param: AdminToken
        bootstack_nodeid:
          get_attr:
          - Controller
          - name
        ceilometer_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - CeilometerApiNetwork
        ceilometer_backend:
          get_param: CeilometerBackend
        ceilometer_coordination_url:
          list_join:
          - ''
          - - redis://
            - get_param: RedisVirtualIP
            - :6379
        ceilometer_dsn:
          list_join:
          - ''
          - - mysql://ceilometer:unset@
            - get_param: MysqlVirtualIP
            - /ceilometer
        ceilometer_metering_secret:
          get_param: CeilometerMeteringSecret
        ceilometer_password:
          get_param: CeilometerPassword
        ceph_cluster_network:
          get_attr:
          - NetIpSubnetMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - CephClusterNetwork
        ceph_public_ip:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - CephPublicNetwork
        ceph_public_network:
          get_attr:
          - NetIpSubnetMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - CephPublicNetwork
        cinder_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - CinderApiNetwork
        cinder_backend_config:
          get_param: CinderBackendConfig
        cinder_dsn:
          list_join:
          - ''
          - - 'mysql://cinder:'
            - get_param: CinderPassword
            - '@'
            - get_param: MysqlVirtualIP
            - /cinder
        cinder_enable_iscsi_backend:
          get_param: CinderEnableIscsiBackend
        cinder_enable_nfs_backend:
          get_param: CinderEnableNfsBackend
        cinder_enable_rbd_backend:
          get_param: CinderEnableRbdBackend
        cinder_iscsi_helper:
          get_param: CinderISCSIHelper
        cinder_iscsi_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - CinderIscsiNetwork
        cinder_lvm_loop_device_size:
          get_param: CinderLVMLoopDeviceSize
        cinder_nfs_mount_options:
          get_param: CinderNfsMountOptions
        cinder_nfs_servers:
          str_replace:
            params:
              SERVERS:
                list_join:
                - ''','''
                - get_param: CinderNfsServers
            template: '[''SERVERS'']'
        cinder_password:
          get_param: CinderPassword
        control_virtual_interface:
          get_param: ControlVirtualInterface
        debug:
          get_param: Debug
        enable_ceph_storage:
          get_param: EnableCephStorage
        enable_galera:
          get_param: EnableGalera
        enable_package_install:
          get_param: EnablePackageInstall
        enable_swift_storage:
          get_param: EnableSwiftStorage
        glance_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - GlanceApiNetwork
        glance_api_servers:
          list_join:
          - ''
          - - get_param: GlanceProtocol
            - ://
            - get_param: GlanceApiVirtualIP
            - ':'
            - get_param: GlancePort
        glance_backend:
          get_param: GlanceBackend
        glance_dsn:
          list_join:
          - ''
          - - 'mysql://glance:'
            - get_param: GlancePassword
            - '@'
            - get_param: MysqlVirtualIP
            - /glance
        glance_file_pcmk_device:
          get_param: GlanceFilePcmkDevice
        glance_file_pcmk_fstype:
          get_param: GlanceFilePcmkFstype
        glance_file_pcmk_manage:
          get_param: GlanceFilePcmkManage
        glance_file_pcmk_options:
          get_param: GlanceFilePcmkOptions
        glance_log_file:
          get_param: GlanceLogFile
        glance_notifier_strategy:
          get_param: GlanceNotifierStrategy
        glance_password:
          get_param: GlancePassword
        glance_port:
          get_param: GlancePort
        glance_registry_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - GlanceRegistryNetwork
        heat.metadata_server_url:
          list_join:
          - ''
          - - http://
            - get_param: HeatApiVirtualIP
            - :8000
        heat.waitcondition_server_url:
          list_join:
          - ''
          - - http://
            - get_param: HeatApiVirtualIP
            - :8000/v1/waitcondition
        heat.watch_server_url:
          list_join:
          - ''
          - - http://
            - get_param: HeatApiVirtualIP
            - :8003
        heat_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - HeatApiNetwork
        heat_auth_encryption_key:
          get_param: HeatAuthEncryptionKey
        heat_dsn:
          list_join:
          - ''
          - - 'mysql://heat:'
            - get_param: HeatPassword
            - '@'
            - get_param: MysqlVirtualIP
            - /heat
        heat_password:
          get_param: HeatPassword
        heat_stack_domain_admin_password:
          get_param: HeatStackDomainAdminPassword
        horizon_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - HorizonNetwork
        horizon_secret:
          get_param: HorizonSecret
        keystone_admin_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - KeystoneAdminApiNetwork
        keystone_auth_address:
          list_join:
          - ''
          - - http://
            - get_param: KeystonePublicApiVirtualIP
            - :5000/v2.0
        keystone_auth_uri:
          list_join:
          - ''
          - - http://
            - get_param: KeystonePublicApiVirtualIP
            - :5000/v2.0/
        keystone_ca_certificate:
          get_param: KeystoneCACertificate
        keystone_dsn:
          list_join:
          - ''
          - - 'mysql://keystone:'
            - get_param: AdminToken
            - '@'
            - get_param: MysqlVirtualIP
            - /keystone
        keystone_ec2_uri:
          list_join:
          - ''
          - - http://
            - get_param: KeystonePublicApiVirtualIP
            - :5000/v2.0/ec2tokens
        keystone_identity_uri:
          list_join:
          - ''
          - - http://
            - get_param: KeystonePublicApiVirtualIP
            - :35357/
        keystone_public_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - KeystonePublicApiNetwork
        keystone_signing_certificate:
          get_param: KeystoneSigningCertificate
        keystone_signing_key:
          get_param: KeystoneSigningKey
        keystone_ssl_certificate:
          get_param: KeystoneSSLCertificate
        keystone_ssl_certificate_key:
          get_param: KeystoneSSLCertificateKey
        memcached_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - MemcachedNetwork
        mongo_db_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - MongoDbNetwork
        mysql_cluster_name:
          str_replace:
            params:
              CLUSTER:
                get_param: MysqlClusterUniquePart
            template: tripleo-CLUSTER
        mysql_innodb_buffer_pool_size:
          get_param: MysqlInnodbBufferPoolSize
        mysql_max_connections:
          get_param: MysqlMaxConnections
        mysql_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - MysqlNetwork
        mysql_root_password:
          get_param: MysqlRootPassword
        neutron_admin_auth_url:
          list_join:
          - ''
          - - http://
            - get_param: KeystonePublicApiVirtualIP
            - :35357/v2.0
        neutron_agent_mode:
          get_param: NeutronAgentMode
        neutron_allow_l3agent_failover:
          get_param: NeutronAllowL3AgentFailover
        neutron_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - NeutronApiNetwork
        neutron_bridge_mappings:
          get_param: NeutronBridgeMappings
        neutron_dhcp_agents_per_network:
          get_param: NeutronDhcpAgentsPerNetwork
        neutron_dnsmasq_options:
          get_param: NeutronDnsmasqOptions
        neutron_dsn:
          list_join:
          - ''
          - - 'mysql://neutron:'
            - get_param: NeutronPassword
            - '@'
            - get_param: MysqlVirtualIP
            - /ovs_neutron?charset=utf8
        neutron_enable_tunneling:
          get_param: NeutronEnableTunnelling
        neutron_external_network_bridge:
          get_param: NeutronExternalNetworkBridge
        neutron_flat_networks:
          get_param: NeutronFlatNetworks
        neutron_l3_ha:
          get_param: NeutronL3HA
        neutron_local_ip:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - NeutronTenantNetwork
        neutron_mechanism_drivers:
          get_param: NeutronMechanismDrivers
        neutron_metadata_proxy_shared_secret:
          get_param: NeutronMetadataProxySharedSecret
        neutron_network_vlan_ranges:
          str_replace:
            params:
              RANGES:
                list_join:
                - ''','''
                - get_param: NeutronNetworkVLANRanges
            template: '[''RANGES'']'
        neutron_password:
          get_param: NeutronPassword
        neutron_public_interface:
          get_param: NeutronPublicInterface
        neutron_public_interface_default_route:
          get_param: NeutronPublicInterfaceDefaultRoute
        neutron_public_interface_ip:
          get_param: NeutronPublicInterfaceIP
        neutron_public_interface_raw_device:
          get_param: NeutronPublicInterfaceRawDevice
        neutron_public_interface_tag:
          get_param: NeutronPublicInterfaceTag
        neutron_router_distributed:
          get_param: NeutronDVR
        neutron_tenant_network_type:
          get_param: NeutronNetworkType
        neutron_tunnel_id_ranges:
          str_replace:
            params:
              RANGES:
                list_join:
                - ''','''
                - get_param: NeutronTunnelIdRanges
            template: '[''RANGES'']'
        neutron_tunnel_types:
          get_param: NeutronTunnelTypes
        neutron_url:
          list_join:
          - ''
          - - http://
            - get_param: NeutronApiVirtualIP
            - :9696
        neutron_vni_ranges:
          str_replace:
            params:
              RANGES:
                list_join:
                - ''','''
                - get_param: NeutronVniRanges
            template: '[''RANGES'']'
        nova_api_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - NovaApiNetwork
        nova_dsn:
          list_join:
          - ''
          - - 'mysql://nova:'
            - get_param: NovaPassword
            - '@'
            - get_param: MysqlVirtualIP
            - /nova
        nova_metadata_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - NovaMetadataNetwork
        nova_password:
          get_param: NovaPassword
        ntp_servers:
          str_replace:
            params:
              server:
                get_param: NtpServer
            template: '["server"]'
        pcsd_password:
          get_param: PcsdPassword
        public_virtual_interface:
          get_param: PublicVirtualInterface
        rabbit_client_port:
          get_param: RabbitClientPort
        rabbit_client_use_ssl:
          get_param: RabbitClientUseSSL
        rabbit_cookie:
          get_param: RabbitCookie
        rabbit_password:
          get_param: RabbitPassword
        rabbit_username:
          get_param: RabbitUserName
        rabbitmq_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - RabbitMqNetwork
        redis_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - RedisNetwork
        redis_vip:
          get_param: RedisVirtualIP
        snmpd_readonly_user_name:
          get_param: SnmpdReadonlyUserName
        snmpd_readonly_user_password:
          get_param: SnmpdReadonlyUserPassword
        swift_hash_suffix:
          get_param: SwiftHashSuffix
        swift_management_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - SwiftMgmtNetwork
        swift_min_part_hours:
          get_param: SwiftMinPartHours
        swift_mount_check:
          get_param: SwiftMountCheck
        swift_part_power:
          get_param: SwiftPartPower
        swift_password:
          get_param: SwiftPassword
        swift_proxy_network:
          get_attr:
          - NetIpMap
          - net_ip_map
          - get_param:
            - ServiceNetMap
            - SwiftProxyNetwork
        swift_replicas:
          get_param: SwiftReplicas
      server:
        get_resource: Controller
    type: OS::TripleO::SoftwareDeployment
  ControllerExtraConfigPre:
    depends_on: ControllerDeployment
    properties:
      server:
        get_resource: Controller
    type: OS::TripleO::ControllerExtraConfigPre
  ExternalPort:
    properties:
      ControlPlaneIP:
        get_attr:
        - Controller
        - networks
        - ctlplane
        - 0
    type: OS::TripleO::Controller::Ports::ExternalPort
  InternalApiPort:
    properties:
      ControlPlaneIP:
        get_attr:
        - Controller
        - networks
        - ctlplane
        - 0
    type: OS::TripleO::Controller::Ports::InternalApiPort
  NetIpMap:
    properties:
      ExternalIp:
        get_attr:
        - ExternalPort
        - ip_address
      InternalApiIp:
        get_attr:
        - InternalApiPort
        - ip_address
      StorageIp:
        get_attr:
        - StoragePort
        - ip_address
      StorageMgmtIp:
        get_attr:
        - StorageMgmtPort
        - ip_address
      TenantIp:
        get_attr:
        - TenantPort
        - ip_address
    type: OS::TripleO::Network::Ports::NetIpMap
  NetIpSubnetMap:
    properties:
      ExternalIp:
        get_attr:
        - ExternalPort
        - ip_subnet
      InternalApiIp:
        get_attr:
        - InternalApiPort
        - ip_subnet
      StorageIp:
        get_attr:
        - StoragePort
        - ip_subnet
      StorageMgmtIp:
        get_attr:
        - StorageMgmtPort
        - ip_subnet
      TenantIp:
        get_attr:
        - TenantPort
        - ip_subnet
    type: OS::TripleO::Network::Ports::NetIpMap
  NetworkConfig:
    properties:
      ExternalIpSubnet:
        get_attr:
        - ExternalPort
        - ip_subnet
      InternalApiIpSubnet:
        get_attr:
        - InternalApiPort
        - ip_subnet
      StorageIpSubnet:
        get_attr:
        - StoragePort
        - ip_subnet
      StorageMgmtIpSubnet:
        get_attr:
        - StorageMgmtPort
        - ip_subnet
      TenantIpSubnet:
        get_attr:
        - TenantPort
        - ip_subnet
    type: OS::TripleO::Controller::Net::SoftwareConfig
  NetworkDeployment:
    properties:
      config:
        get_resource: NetworkConfig
      input_values:
        bridge_name: br-ex
        interface_name:
          get_param: NeutronPublicInterface
      server:
        get_resource: Controller
    type: OS::TripleO::SoftwareDeployment
  NodeUserData:
    type: OS::TripleO::NodeUserData
  StorageMgmtPort:
    properties:
      ControlPlaneIP:
        get_attr:
        - Controller
        - networks
        - ctlplane
        - 0
    type: OS::TripleO::Controller::Ports::StorageMgmtPort
  StoragePort:
    properties:
      ControlPlaneIP:
        get_attr:
        - Controller
        - networks
        - ctlplane
        - 0
    type: OS::TripleO::Controller::Ports::StoragePort
  TenantPort:
    properties:
      ControlPlaneIP:
        get_attr:
        - Controller
        - networks
        - ctlplane
        - 0
    type: OS::TripleO::Controller::Ports::TenantPort
  UpdateConfig:
    type: OS::TripleO::Tasks::PackageUpdate
  UpdateDeployment:
    properties:
      config:
        get_resource: UpdateConfig
      input_values:
        update_identifier:
          get_param: UpdateIdentifier
      server:
        get_resource: Controller
    type: OS::Heat::SoftwareDeployment
